/*
This code is unmodified from the HS100 API code previously developed by github contributor plasticrake.
*/
const dgram = require('dgram');
const socket = dgram.createSocket('udp4');

socket.on('error', (err) => {
  console.error('TP-Link Bulb Client UDP error');
  console.trace(err);
  socket.close();
});

socket.on('message', (msg, rinfo) => {
  // Ignore own messages and false formats
  // if (utils.getHostIPs().indexOf(rinfo.address) >= 0 || !Buffer.isBuffer(msg)) {
  //   return
  // }

  console.log('DEBUG - ' + msg.toString('hex') + ' from ' + rinfo.address);

});

//**************************************
// Bind socket 9999 to local host
//**************************************
socket.bind(9999, 'localhost', () => {
  socket.setBroadcast(true);

  // Start scanning

  if (typeof callback === 'function') {
    // return callback()
  }
});

//**************************************
// Sends poll to port 9999 on Boadcast, looking for response
//**************************************
socket.send('Hello', 9999, '255.255.255.255', () => {
  console.log('sending');
});

